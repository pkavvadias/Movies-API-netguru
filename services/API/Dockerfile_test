FROM node:14.15-alpine

WORKDIR /app

COPY ./package.json ./package-lock.json ./
RUN npm ci
ARG JWT_SECRET
ARG POSTGRES_PASSWORD_STAGE
ARG POSTGRES_USER_STAGE
ARG POSTGRES_DB_STAGE
ARG POSTGRES_PORT_STAGE
ARG POSTGRES_URL_STAGE
ARG OMDB_KEY
ARG API_APP_PORT

ENV JWT_SECRET $JWT_SECRET
ENV POSTGRES_PASSWORD $POSTGRES_PASSWORD_STAGE
ENV POSTGRES_USER $POSTGRES_USER_STAGE
ENV POSTGRES_DB $POSTGRES_DB_STAGE
ENV POSTGRES_PORT $POSTGRES_PORT_STAGE
ENV POSTGRES_URL $POSTGRES_URL_STAGE
ENV OMDB_KEY $OMDB_KEY
ENV API_APP_PORT $API_APP_PORT

RUN mkdir ./src
COPY /src ./src
RUN npm run test

#CMD [ "npm", "test" ]